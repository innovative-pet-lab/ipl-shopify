{%- if product.media.size > 0 -%}
  <div class="product-gallery">
    <div class="product-gallery__wrapper">
      <!-- Thumbnail Navigation -->
      <div class="product-gallery__thumbnails{% if product.media.size > 5 %} is-slider{% endif %}">
        <div class="swiper-wrapper">
          {%- for media in product.media -%}
            <div class="swiper-slide">
              <button 
                class="product-gallery__thumbnail{% if forloop.first %} is-active{% endif %}" 
                data-media-id="{{ media.id }}"
                aria-label="Show image {{ forloop.index }} of {{ product.media.size }}"
              >
                <img 
                  width="" 
                  height="" 
                  src="{{ media | image_url: width: 100, crop: 'center' }}" 
                  alt="{{ media.alt | escape }}" 
                  loading="lazy">
              </button>
            </div>
          {%- endfor -%}
        </div>
      </div>


      {%- if product.media.size > 5 -%}
        <div class="swiper-button-wrap">
          <div class="swiper-button-prev-ipl">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M30 16C30 16.2652 29.8946 16.5195 29.7071 16.7071C29.5196 16.8946 29.2652 17 29 17L5.414 17L11.708 23.292C11.8958 23.4797 12.0013 23.7344 12.0013 24C12.0013 24.2655 11.8958 24.5202 11.708 24.708C11.5202 24.8957 11.2655 25.0012 11 25.0012C10.7344 25.0012 10.4798 24.8957 10.292 24.708L2.292 16.708C2.19887 16.6151 2.12499 16.5047 2.07457 16.3832C2.02416 16.2617 1.99821 16.1315 1.99821 16C1.99821 15.8684 2.02416 15.7382 2.07457 15.6167C2.12499 15.4952 2.19887 15.3848 2.292 15.292L10.292 7.29196C10.4798 7.10418 10.7344 6.99869 11 6.99869C11.2656 6.99869 11.5202 7.10418 11.708 7.29196C11.8958 7.47973 12.0013 7.73441 12.0013 7.99996C12.0013 8.26551 11.8958 8.52018 11.708 8.70796L5.414 15L29 15C29.2652 15 29.5196 15.1053 29.7071 15.2929C29.8946 15.4804 30 15.7347 30 16Z" fill="#73C7AD"/>
            </svg>
          </div>
          <div class="swiper-button-next-ipl">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fill-rule="evenodd" clip-rule="evenodd" d="M2 16C2 15.7348 2.10536 15.4805 2.29289 15.2929C2.48043 15.1054 2.73478 15 3 15H26.586L20.292 8.70804C20.1042 8.52027 19.9987 8.26559 19.9987 8.00004C19.9987 7.73449 20.1042 7.47982 20.292 7.29204C20.4798 7.10427 20.7345 6.99878 21 6.99878C21.2656 6.99878 21.5202 7.10427 21.708 7.29204L29.708 15.292C29.8011 15.3849 29.875 15.4953 29.9254 15.6168C29.9758 15.7383 30.0018 15.8685 30.0018 16C30.0018 16.1316 29.9758 16.2618 29.9254 16.3833C29.875 16.5048 29.8011 16.6152 29.708 16.708L21.708 24.708C21.5202 24.8958 21.2656 25.0013 21 25.0013C20.7345 25.0013 20.4798 24.8958 20.292 24.708C20.1042 24.5203 19.9987 24.2656 19.9987 24C19.9987 23.7345 20.1042 23.4798 20.292 23.292L26.586 17H3C2.73478 17 2.48043 16.8947 2.29289 16.7071C2.10536 16.5196 2 16.2653 2 16Z" fill="#73C7AD"/>
            </svg>
          </div>
        </div>
      {%- endif -%}

      <!-- Main Image Viewer -->
      <div class="product-gallery__viewer">
        {%- for media in product.media -%}
          <div 
            class="product-gallery__image-wrapper{% if forloop.first %} is-active{% endif %}" 
            data-media-id="{{ media.id }}"
          >
            <div class="product-gallery__image">
              <img 
                width="" 
                height="" 
                src="{{ media | image_url: width: 800 }}" 
                alt="{{ media.alt | escape }}" 
                loading="eager">
            </div>
          </div>
        {%- endfor -%}
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      if (document.querySelector('.is-slider')) {
        const thumbnailSwiper = new Swiper('.product-gallery__thumbnails', {
          spaceBetween: 5, 
          slidesPerView: 5, 
          navigation: {
            nextEl: '.swiper-button-next-ipl',
            prevEl: '.swiper-button-prev-ipl',
          },
          breakpoints: {
            1024: { // Desktop view
              slidesPerView: 5,
              slideWidth: 'auto', 
            },
            768: { // Tablet view
              slidesPerView: 5,
              slideWidth: 105, 
            },
            480: { // Mobile view
              slidesPerView: 4,
            },
          },
        });
      }

      // Main viewer functionality
      const thumbnails = document.querySelectorAll('.product-gallery__thumbnail');
      const imageWrappers = document.querySelectorAll('.product-gallery__image-wrapper');
      let activeIndex = 0;

      thumbnails.forEach((thumbnail, index) => {
        thumbnail.addEventListener('click', () => {
          updateActiveSlide(index);
        });
      });

      function updateActiveSlide(index) {
        activeIndex = index;

        thumbnails.forEach((thumbnail) => thumbnail.classList.remove('is-active'));
        imageWrappers.forEach((wrapper) => wrapper.classList.remove('is-active'));

        thumbnails[activeIndex].classList.add('is-active');
        imageWrappers[activeIndex].classList.add('is-active');
      }
    });
  </script>
{%- endif -%}